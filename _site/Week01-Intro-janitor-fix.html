<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Chris Papalia" />


<title>Week01-Intro (Fixed Janitor Error)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">AC Plus - Spring 2020</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Week 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Week01-Intro.html">Week 1</a>
    </li>
    <li>
      <a href="Week01-Intro-janitor-fix.html">Week 1 (Fix)</a>
    </li>
  </ul>
</li>
<li>
  <a href="Week02-Saving-a-Plot.html">Week 2</a>
</li>
<li>
  <a href="Week03-apple-mobility-tracker.html">Week 3</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Week01-Intro (Fixed Janitor Error)</h1>
<h4 class="author">Chris Papalia</h4>
<h4 class="date">4/12/2020</h4>

</div>


<p>This document will walk you through how to create a plot similar to the one that you see below. It will use the data from Johns Hopkins University to loosely replicate a plot that shows the outbreak of COVID-19 for some countries, and for four provinces in Canada.</p>
<p>Here is the plot that we will try and replicate:</p>
<div class="figure">
<img src="Fin_times_plot.png" alt="Financial Times Plot of Deaths on a Log Scale" />
<p class="caption">Financial Times Plot of Deaths on a Log Scale</p>
</div>
<p>Then, in Week 2, you will be able to create your own plots to show the outbreak in an area that you’re interested in.</p>
<div id="creating-a-plot-in-r" class="section level1">
<h1>Creating a Plot in R</h1>
<div id="load-libraries-and-set-a-theme" class="section level3">
<h3>1. Load Libraries and Set a Theme</h3>
<p>In order to work with R, you’ll need access to many different packages that allow the user to use different tools. Each of these packages below has a function. Most importantly, the tidyverse package allows the user to import, tidy, transform, and visualize data using commands that are relatively intuitive.</p>
<p>The other packages each perform some function in this module.</p>
<pre class="r"><code>library(tidyverse)
library(janitor)
library(lubridate)
library(ggrepel)
library(knitr)</code></pre>
<p>I have set the theme to light to avoid the gray background in graphics.</p>
<pre class="r"><code>theme_set(theme_light())</code></pre>
</div>
<div id="load-the-data" class="section level3">
<h3>2. Load the Data</h3>
<p>We will load the data using the data source of the following website <a href="https://coronavirus.jhu.edu/map.html">Johns Hopkins CSSE Map</a></p>
<p>In order to get the data, we will use a link to the Johns Hopkins CSSE data in GitHub. The following command will load the data for us using the <code>read_csv</code> command.</p>
<pre class="r"><code>covid_cases &lt;- read_csv(&quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;)</code></pre>
<p>Once you run this line of code, you should see the <code>covid_cases</code> object in the Environment pane. If you click the object in the environment pane, you can view the data in a tabel format in the <em>Source</em> pane in the upper left.</p>
</div>
<div id="tidy-and-transform-the-data-to-make-a-plot" class="section level3">
<h3>3. Tidy and Transform the Data to Make a Plot</h3>
<div id="a.-clean-column-names" class="section level4">
<h4>A. Clean column Names</h4>
<p>You’ll notice that when we view the file, it is not <em>tidy</em> data because each day is listed as a column rather than as an observation. We can inspect the column names with the command below.</p>
<pre class="r"><code>colnames(covid_cases)[5:ncol(covid_cases)]</code></pre>
<p>It’s also important to see that the dates are not in a nice format. We would pefer to use <em>YYYY-MM-DD</em> as our date input, so we will use the following command to rename the columns with the dates formatted correctly.</p>
<pre class="r"><code>old_names &lt;- colnames(covid_cases)[5:ncol(covid_cases)]
new_names &lt;- parse_date(colnames(covid_cases)[5:ncol(covid_cases)], &quot;%m/%d/%y&quot;)

covid_cases&lt;- covid_cases %&gt;% 
  rename_at(vars(old_names), function(x) new_names)</code></pre>
<p>Then we will reshape the data into a long <em>tidy</em> format using the <code>pivot_longer()</code> command. Now for each county observation (row), we will move the dates under the country. We will call this new dataset <code>covid_cases_tidy</code>. You can inspect it in the environment to see how it looks different from the <code>covid_cases</code> that we input from GitHub.</p>
<pre class="r"><code>covid_cases_tidy &lt;- covid_cases %&gt;% 
  pivot_longer(
    cols = -`Province/State`:-Long,  
    names_to = &quot;date&quot;, 
    values_to = &quot;cases&quot;
  ) %&gt;% as_tibble() %&gt;% 
  mutate(date = as.Date(date)) %&gt;% 
  set_names(tolower(make.names(names(.)))) # The janitor package was broken in the cloud, here is the fix</code></pre>
</div>
<div id="b.-transform-and-summarise-the-data-using-the-pipe-operator" class="section level4">
<h4>B. Transform and Summarise the Data Using the Pipe Operator</h4>
<p>For the particular plot we’re trying to make, we only want to use the data for the Provinces in Canada. So we need to filter the data to look only at what we’re interested in. Once again, we can see the data by pressing on the <code>covid_cases_tidy</code> object in the environment pane in the upper right.</p>
<p>Let’s look at the data of the top 10 most affected countries in the world and find that data using some commands that we can find in the <code>dplyr</code> package, which is part of the tidyverse. Since we know the data is tidy, that being each row represents a country’s day of total cases, we can use use some statistical analysis to pull some information out of the data</p>
<p>Let’s see what are most affected countries are in the world are, and how many cases they have. We will use the pipe operator <code>%&gt;%</code> to use the previous output at the input in the next line of code.</p>
<table>
<thead>
<tr class="header">
<th align="left">country.region</th>
<th align="right">cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">US</td>
<td align="right">1012582</td>
</tr>
<tr class="even">
<td align="left">Spain</td>
<td align="right">232128</td>
</tr>
<tr class="odd">
<td align="left">Italy</td>
<td align="right">201505</td>
</tr>
<tr class="even">
<td align="left">France</td>
<td align="right">167605</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">161145</td>
</tr>
<tr class="even">
<td align="left">Germany</td>
<td align="right">159912</td>
</tr>
<tr class="odd">
<td align="left">Turkey</td>
<td align="right">114653</td>
</tr>
<tr class="even">
<td align="left">Russia</td>
<td align="right">93558</td>
</tr>
<tr class="odd">
<td align="left">Iran</td>
<td align="right">92584</td>
</tr>
<tr class="even">
<td align="left">Brazil</td>
<td align="right">73235</td>
</tr>
<tr class="odd">
<td align="left">China</td>
<td align="right">68128</td>
</tr>
<tr class="even">
<td align="left">Belgium</td>
<td align="right">47334</td>
</tr>
<tr class="odd">
<td align="left">Netherlands</td>
<td align="right">38416</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">31324</td>
</tr>
<tr class="odd">
<td align="left">Peru</td>
<td align="right">31190</td>
</tr>
<tr class="even">
<td align="left">Switzerland</td>
<td align="right">29264</td>
</tr>
<tr class="odd">
<td align="left">Canada</td>
<td align="right">25761</td>
</tr>
<tr class="even">
<td align="left">Portugal</td>
<td align="right">24322</td>
</tr>
<tr class="odd">
<td align="left">Ecuador</td>
<td align="right">24258</td>
</tr>
<tr class="even">
<td align="left">Saudi Arabia</td>
<td align="right">20077</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="create-a-summary-plot" class="section level3">
<h3>Create a Summary Plot</h3>
<p>Now that we have this data output, let’s make our first plot of the data. This will be a bar graph that will show the twenty most-affected countries in the world. It will essentially take the output of the last code and use it to make a plot.</p>
<p>Some things to keep in mind. The output is a <code>tibble</code> which is a type of data frame that R likes work with. The data was initially 25872 by 6 tibble and it’s been converted into a 20 by 2 tibble.</p>
<p>The following plot, take the data from the chart and creates a plot to show the countries that are most affected by the COVID-19 outbreak.</p>
<p><img src="Week01-Intro-janitor-fix_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="covid-19-outbreak-in-a-plot" class="section level3">
<h3>COVID-19 Outbreak In A Plot</h3>
<p>Now that we have shown the countries most affected by COVID-19 in a summary plot, let’s look at how some of this data in a time-series plot. In general, the growth of COVID-19 is an exponetial growth curve. For instance, we can look at some of the most affected countries in the world and see how their growth curves look. Let’s choose, the US, Spain, Italy, and the UK.</p>
<p>We can view this data using the filter command, and then plotting it. One of the nice features in R, is that we are still using the basic dataset that we started with rather than needing to change it a bunch and create new sheets like we might need to in Excel.</p>
<p><img src="Week01-Intro-janitor-fix_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>In this plot, we can see the different growth rates of the countries, but it’s difficult to determine where on the growth curve these countries are, so it’s helpful to make a plot by the number of days since a certain number of cases.</p>
</div>
<div id="covid-19-plots" class="section level3">
<h3>COVID-19 Plots</h3>
<p>The plots below replicate many of the features of the financial times plot. Using RStudio.Cloud and by following along, you will be able to replicate the main features of the plot.</p>
<pre class="r"><code>covid_cases_tidy %&gt;% 
  filter(country.region %in% c(&quot;US&quot;, &quot;Italy&quot;, &quot;Spain&quot;, &quot;United Kingdom&quot;, &quot;Canada&quot;, &quot;Germany&quot;)) %&gt;%
  group_by(country.region, date) %&gt;%
  summarise(cases = sum(cases)) %&gt;% 
  mutate(daily_cases = c(cases[1], diff(cases))) %&gt;%
  filter(daily_cases &gt;= 10) %&gt;% 
  mutate(days = 1:n()) %&gt;% 
  mutate(label = if_else(days == max(days), 
                         country.region, 
                         NA_character_)) %&gt;% 
  View()</code></pre>
<p><img src="Week01-Intro-janitor-fix_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p><img src="Week01-Intro-janitor-fix_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
</div>
<div id="goals-for-the-next-graph" class="section level1">
<h1>Goals for the next Graph</h1>
<p>So, you’ve just made a some plots using my commands.Now let’s spend a couple minutes using the <code>labs()</code> function to make nicer labels and headings for some of the plots. Let’s start with the plot below. You can reference previous plots to use the command and run the chunk to see how each label works. We will use some fancier labels next week to manipulate a plot.</p>
<p><img src="Week01-Intro-janitor-fix_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>For the next plot, take some to inspect the data to see what’s available using the viewer in the top left plane by clicking on the object. You’ll notice that not every country has provinces or states listed, so you’ll need to try and select a few countries that you’re interested in.</p>
<p>You can then modify the commands in the plot below:</p>
<p><img src="Week01-Intro-janitor-fix_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>For future data plots, you can go to the GitHub repository for more data. You can take a look and explore the deaths from COVID-19 here: <a href="https://github.com/CSSEGISandData/COVID-19">https://github.com/CSSEGISandData/COVID-19</a>.</p>
<p>This link will take you to the <a href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series">COVID-19 Time Series Data</a> for cases in the US and globally. Refer to the code at the top of the page to read data into R. I’ll do this with you in our live session.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
